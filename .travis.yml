dist: xenial

language: python

python:
 - "3.5"
 - "3.6"

addons:
  postgresql: "9.5"
  apt:
    packages:
      - gdal-bin
      - libgdal-dev
      - python3-psycopg2
      - postgresql-9.5-postgis-2.4
      - rabbitmq-server

install:
 - wget https://github.com/openmeteo/dickinson/archive/0.2.1.tar.gz
 - tar xzf 0.2.1.tar.gz
 - cd dickinson-0.2.1
 - ./configure
 - make
 - sudo make install
 - sudo ldconfig
 - cd ..

 - CPLUS_INCLUDE_PATH=/usr/include/gdal C_INCLUDE_PATH=/usr/include/gdal pip install 'gdal<1.11'
 - pip install psycopg2==2.7.4
 - pip install codecov
 - pip install -r requirements.txt
 - psql -U postgres -c "create extension postgis"
 - psql -U postgres -c "create database aira"
 - cp aira_project/settings/travis.py aira_project/settings/local.py

script:
 - coverage run --include="./*" --omit="*/tests/*","*/tests.py" manage.py test -v2

after_success:
 - codecov
