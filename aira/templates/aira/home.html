{% extends 'base.html' %}
{% load bootstrap3 %}

{% block title %} Home - {{user}} {% endblock %}

{% block content %}
{% if not profile %}
  <div class="alert alert-warning">
    <a href="#" class="close" data-dismiss="alert">&times;</a><i class="fa fa-hand-o-right"></i> &nbsp; Please update your pernonal information<a href="{% url 'create_profile' %}"> here </a> 
  </div>
{% endif %}
<!-- context['map'] -->
<div class="panel panel-default">
  <div class="panel-heading"></div>
    <div class="panel-body">
      <div id="open_map" class="map"></div>
       <script type="text/javascript">
          map = new OpenLayers.Map("open_map");
          map.addLayer(new OpenLayers.Layer.OSM());
          {% for lat,lon in coords %}
          var lonLat = new OpenLayers.LonLat({{lon}}, {{lat}})
                .transform(
                  new OpenLayers.Projection("EPSG:4326"), // transform from WGS 1984
                  map.getProjectionObject() // to Spherical Mercator Projection
                );
          var zoom=9;
          var markers = new OpenLayers.Layer.Markers( "Markers" );
          map.addLayer(markers);
          markers.addMarker(new OpenLayers.Marker(lonLat));
          map.setCenter (lonLat, zoom);
          {% endfor %}
       </script>
      {% if profile %}    
        <div class="panel-footer">
          <strong>First name:</strong> <a href="{% url 'update_profile' profile.id %}">{{ profile.first_name }}</a><br>
          <strong>Last name :</strong> <a href="{% url 'update_profile' profile.id %}">{{ profile.last_name }}</a><br>
          <strong>Address:</strong> 
          {% if profile.address %}
            <a href="{% url 'update_profile' profile.id %}">{{ profile.address }}</a><br></div>
          {% else %}
            <a href="{% url 'update_profile' profile.id %}"> [edit] </a><br></div>
          {% endif %}
      {% endif %}
</div>
{% if not agrifields %}
  <div class="alert alert-warning">
    <a href="#" class="close" data-dismiss="alert">&times;</a>
    <i class="fa fa-exclamation-triangle"></i> &nbsp; Hmmm, it seems you have't any fields, Add at least one <a href="{% url 'create_agrifield' %}"> here </a> 
  </div>
{% else %}
  <div class="panel panel-default">
    <div class="panel-heading">
      <a class="btn btn-success btn-xs" href="{% url 'create_agrifield' %}"><i class="fa fa-plus-square-o"></i>&nbsp;<i class="fa fa-minus-square-o"></i>&nbsp; Agrifields</a>
    </div>
    {% for f in agrifields %}
      <div class="panel-body">
        <div class="col-xs-12">
          <p> <a href="{% url 'update_agrifield' f.id %}">{{ f.name }}</a> is growing <a href="{% url 'update_agrifield' f.id %}">{{ f.ct.ct_name }}</a> using <a href="{% url 'update_agrifield' f.id %}">{{ f.irrt.irrt_name }}</a> irrigation system. </p>
          {% if f.irrigationlog_set.latest %} 
            <p>Last irrigation event was <a href="{% url 'update_irrlog' f.irrigationlog_set.latest.id %}"> {{ f.irrigationlog_set.latest.water_amount }}&nbsp;m <sup>3</sup></a> of water, irrigated at&nbsp;  <a href="{% url 'update_irrlog' f.irrigationlog_set.latest.id %}"><i class="fa fa-clock-o"></i>&nbsp;{{ f.irrigationlog_set.latest.time }}</a> </p>
            <hr>
            {% if f.irw %}
              <p><span class="text text-success">Aira</span> latest advice is to irrigate<span class="text text-success">&nbsp;<i class="fa fa-tint"></i>&nbsp; {{ f.irw }} m<sup>3</sup></span> of water during <span class="text text-success"><i class="fa fa-clock-0"></i>99/12/2124</span>&nbsp;daytime (<a href="{% url 'advice' f.id %}">Calculation Report</a>).</p>   
                {% if f.warning %}
                  <div class="alert alert-warning">
                    <a href="#" class="close" data-dismiss="alert">&times;</a><i class="fa fa-exclamation-triangle "></i> &nbsp; Hmmm, it seems that your latest Irrigation log for <a href="{% url 'update_agrifield' f.id %}">{{ f.name }}</a> is more than 5 days for aira advice to be accurate ( actually is {{ f.warning_days }} days passed ).<br> Please update your Irrigation logs <a href="{% url 'create_irrlog' f.id %}"> here </a>.
                  </div>
                {% endif %}
            {% else %}
              <div class="alert alert-danger">
                <a href="#" class="close" data-dismiss="alert">&times;</a><i class="fa fa-exclamation-triangle"></i> &nbsp; Hmmm, it seems that your <strong>{{ f.name }} location </strong> or  <strong>{{f.name}} TimeLog </strong> is <strong>out of aira's range</strong>. <br> Please sent us <a href="#">ticket</a> <br>
              </div>
            {% endif %}
            <sub><a class="btn btn-success btn-xs" href="{% url 'create_irrlog' f.id %}"><i class="fa fa-plus-square-o"></i>&nbsp;<i class="fa fa-minus-square-o"></i>&nbsp; TimeLogs</a></sub></p>
            <hr style="height:1px;border:none;color:#333;background-color:#333;">
            {% else %}
            <div class="alert alert-warning">
              <a href="#" class="close" data-dismiss="alert">&times;</a><i class="fa fa-exclamation-triangle "></i> &nbsp; Hmmm, it seems you have't any IrrigationLogs for <a href="{% url 'update_agrifield' f.id %}">{{ f.name }}</a> Agrifield, Please add at least one <a href="{% url 'create_irrlog' f.id %}"> here </a> 
            </div>
            {% endif %}
        </div>
      </div>         
    {% endfor %}
{% endif %}
{% endblock %}