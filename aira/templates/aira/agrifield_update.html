{% extends 'base.html' %}
{% load bootstrap3 %}
{% block title %} {{ user }} {% endblock %}

{% block content %}
<div class="row">
  <div class="col-lg-12">
    <div class="panel panel-default">
      <div class="panel-heading">
        <h4>Update {{ object.name }} Agrifield</h4>
      </div>
       <div class="panel panel-body">
        <div class="col-md-6">
            <div id="on_clink_map" class="map"></div>
            <script>
                map = new OpenLayers.Map('on_clink_map',
                      {units: 'm',
                       displayProjection: 'EPSG:4326',
                       controls: [new OpenLayers.Control.LayerSwitcher(),
                                  new OpenLayers.Control.Zoom(),
                                  new OpenLayers.Control.MousePosition({prefix:'Coordinates(EPSG:3857): '}),
                                  new OpenLayers.Control.ScaleLine()]
                       });
                // Open Cycle
                var cycle = new OpenLayers.Layer.OSM.CycleMap(
                          "Open Cycle Map",
                          {isBaseLayer: true,
                           projection: 'EPSG:3857'});
                // OSM to be changed by Ktimatologio layer
                var osm = new OpenLayers.Layer.OSM();
                map.addLayers([cycle, osm]);
                var fieldloc = new OpenLayers.LonLat({{ object.longitude }}, {{ object.latitude }}).transform('EPSG:4326', 'EPSG:3857');
                var marker = new OpenLayers.Marker(fieldloc)
                var markers = new OpenLayers.Layer.Markers( "{{ object.name }}" );
                map.addLayer(markers);
                markers.addMarker(marker);
                map.setCenter(fieldloc, 10);
                map.events.register("click", map , function(e){
                            var opx = map.getLonLatFromPixel(e.xy) ;
                            var marker = new OpenLayers.Marker(opx);
                            markers.clearMarkers();
                            markers.addMarker(marker);
                            var lonlat = map.getLonLatFromPixel(e.xy).transform(toProjection, fromProjection);
                              document.getElementById("id_latitude").value = lonlat.lat;
                              document.getElementById("id_longitude").value = lonlat.lon;
                });
              </script>
              <sub> Click on Map to add your Field coordinates</sub>
        </div>
        <div class="col-md-6">
          <form method="post" role="form">
            {% csrf_token %}
            {% bootstrap_form form %}
            {% buttons %}
              <button type="submit" class="btn btn-success btn-xs">Submit</button>
            {% endbuttons %}
          </form>
        </div>
    </div>
  </div>
</div>
{% endblock %}
