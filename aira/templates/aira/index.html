{% extends 'base.html' %}
{% load bootstrap3 %}

{% block title %} Welcome {% endblock %}

{% block content %}
<div class="jumbotron">
  <div class="container">
    <h3>
    <span class="text-success">A</span>gricultural
    <span class="text-success">IR</span>rigation
    <span class="text-success">A</span>dvisor</h3>
    <p>using
      <a target = "_blank"href="http://openmeteo.org/">OpenMeteo.org</a> measurements,
      <a target = "_blank" href="http://pthelma.readthedocs.org/en/latest/">Pthelma</a> Models,
      <a target = "_blank"href="http://cirrus.meteo.noa.gr/forecast/bolam/index.htm">NOA</a> forecast.
    </p>
  </div>
</div>
<hr>
<div class="row">
  <div class="col-md-12">
    <div class="panel panel-default">
        <div class="panel-heading">
          <h3 class="panel-title"> Spatial Datasets on <span class="text-success" id='date_map'></span> </h3>
        </div>
          <div class="panel-body">
            <div class="col-md-9">
              <div id="wms_map" class="map"></div>
            </div>
            <div class="col-md-3">
                  <input type="hidden" class="form-control" id="mirror_field" value="" readonly />
              <div class="form_datetime"> </div>
              <br>
              <div class="row">
                <div class="col-md-2 col-md-offset-3">
                  <button id="id_button_date" type="submit" class="btn btn-success btn-xs" onclick="create_map(document.getElementById('mirror_field').value)">View Map</button>
                </div>
              </div>

            </div>
        </div>
    </div>
  </div>
</div>
      <script type="text/javascript">
          $(".form_datetime").datetimepicker({
            format: "yyyy-mm-dd",
            startDate: "2015-01-01",
            autoclose: true,
            todayBtn: true,
            pickerPosition: "bottom-left",
            minView:2,
            linkField: "mirror_field",
            linkFormat: "yyyy-mm-dd",
            pickerPosition: "bottom-left"
            });

          function create_map(date)
            {
              //Clear previous map
              document.getElementById('wms_map').innerHTML = ""
              var date_selected = date;
              map = new OpenLayers.Map("wms_map");
              var wms_evap = new OpenLayers.Layer.WMS( "Daily Evaporation "+ date_selected,
                        "http://megdobas.irrigation-management.eu/cgi-bin/mapserver?map=/var/cache/pthelma/mapserver-historical.map",
                          {layers: 'Daily_evaporation_'+ date_selected,
                           format: 'png',
                           bbox: '20.7543000000000006,38.9926000000000030,21.1385000000000005,39.2668999999999997'},
                          {projection: new OpenLayers.Projection("EPSG:4326"), units: "m"});
              var wms_humidity = new OpenLayers.Layer.WMS( "Daily Humidity "+ date_selected,
                        "http://megdobas.irrigation-management.eu/cgi-bin/mapserver?map=/var/cache/pthelma/mapserver-historical.map",
                          {layers: 'Daily_humidity_'+ date_selected, format: 'png',
                           bbox: '20.7543000000000006,38.9926000000000030,21.1385000000000005,39.2668999999999997'},
                          {projection: new OpenLayers.Projection("EPSG:4326"), units: "m"});
              var wms_rain = new OpenLayers.Layer.WMS( "Daily Rainfall "+ date_selected,
                        "http://megdobas.irrigation-management.eu/cgi-bin/mapserver?map=/var/cache/pthelma/mapserver-historical.map",
                          {layers: 'Daily_rain_'+ date_selected, format: 'png',
                           bbox: '20.7543000000000006,38.9926000000000030,21.1385000000000005,39.2668999999999997'},
                          {projection: new OpenLayers.Projection("EPSG:4326"), units: "m"});
              var wms_temperature = new OpenLayers.Layer.WMS( "Daily Temperature "+ date_selected,
                        "http://megdobas.irrigation-management.eu/cgi-bin/mapserver?map=/var/cache/pthelma/mapserver-historical.map",
                          {layers: 'Daily_temperature_'+ date_selected, format: 'png',
                           bbox: '20.7543000000000006,38.9926000000000030,21.1385000000000005,39.2668999999999997'},
                          {projection: new OpenLayers.Projection("EPSG:4326"), units: "m"});
              var wms_solar_radiation = new OpenLayers.Layer.WMS( "Daily Solar Radiation "+ date_selected,
                        "http://megdobas.irrigation-management.eu/cgi-bin/mapserver?map=/var/cache/pthelma/mapserver-historical.map",
                          {layers: 'Daily_solar_radiation_'+ date_selected, format: 'png',
                           bbox: '20.7543000000000006,38.9926000000000030,21.1385000000000005,39.2668999999999997'},
                          {projection: new OpenLayers.Projection("EPSG:4326"), units: "m"});
              var wms_pressure = new OpenLayers.Layer.WMS( "Daily Solar Pressure "+ date_selected,
                        "http://megdobas.irrigation-management.eu/cgi-bin/mapserver?map=/var/cache/pthelma/mapserver-historical.map",
                          {layers: 'Daily_pressure_'+ date_selected, format: 'png',
                           bbox: '20.7543000000000006,38.9926000000000030,21.1385000000000005,39.2668999999999997'},
                          {projection: new OpenLayers.Projection("EPSG:4326"), units: "m"});
              var wms_wind_speed = new OpenLayers.Layer.WMS( "Daily Wind Speed "+ date_selected,
                        "http://megdobas.irrigation-management.eu/cgi-bin/mapserver?map=/var/cache/pthelma/mapserver-historical.map",
                          {layers: 'Daily_wind_speed_'+ date_selected, format: 'png',
                           bbox: '20.7543000000000006,38.9926000000000030,21.1385000000000005,39.2668999999999997'},
                          {projection: new OpenLayers.Projection("EPSG:4326"), units: "m"});
              map.addLayers([wms_evap,wms_humidity,wms_rain, wms_temperature, wms_solar_radiation, wms_pressure, wms_wind_speed]);

              map.addControl(new OpenLayers.Control.LayerSwitcher());
              map.setCenter (new OpenLayers.LonLat(20.98, 39.15), 11);
              document.getElementById('date_map').innerHTML = date_selected;
           }
           // Initial map in first request
           create_map("2015-01-01");
      </script>

{% endblock %}

